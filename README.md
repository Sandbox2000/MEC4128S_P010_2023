# MEC4128S_P010_2023
This repository contains all the data necessary to reproduce the results for the my research project investigating the EMI generated by a BLDC motor.

Instructions for running all the code:

###MAGNETOMETER MCU CODE###
The code was implemented using PlatformIO and will be easiest to run/edit using platformIO. The project can be imported using platformIO for visual studio. All required libraries have been uploaded with the source code for the MCU.
The GPIO config is detailed in the main.c file for the microcontroller. 
The code and libraries used is setup to work with an ESP32 MCU, however the code is written using Arduino libraries. Therefore converting the code to use and Arduino is trivial.



###PROCESSING APPLICATION###
Processing must be downloaded and installed from processing.org. The default setup is suitable for this application.
Once installed, the code for the processing application can be opened. This will allow for the code to be run.

The processing application reads all the mangetometer data from the serial port, including the POT value for controlling the motor speeds. To save the data collected from the magnetometer as a .csv file, the Pot value must be set to 80 (which turns the motor off).

The steps for running the code is as follows:
-  Plug in the MCU that is running the firmware for reading the magnetometer values.
-  Run the processing application
-  Once enough data is collected turn the POT off to save the data.

NOTE: Do not wait too long to run the processing application after the MCU is plugged in, otherwise a serial port reading error may occur.


###PYTHON FFT GENERATOR###

The CSV files have been saved to collect the data in the X,Y and Z axis, as well as the time collected by the processing application and the time collected from the MCU since startup.
The panda has been setup to fetch data from the Z axis and the MCU time columns.

The steps for running the code is as follows:
-  Set the correct file path by uncommenting the desired dataset at the top of the file.
-  The python program can then be run, where graphs of the FFT and waveform data will be displayed for each csv file processed.


###MATLAB FILTER CODE###

The MATLAB file can be opened in MATLAB, and the file path for the data that needs to be processed can be set at the top of the program.
The notch frequencies and notch width for each test is also set at the top of the MATLAB file.

Once the file path and filter parameters are set, the code can be run to generate the filtered code.
